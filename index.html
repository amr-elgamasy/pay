<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ูููุณูุง - ุงููุญูุธุฉ ุงูุฌูุงุนูุฉ</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.rtl.min.css" rel="stylesheet">
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts (Arabic) -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <!-- AOS Animation Library -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <!-- Chart.js for Charts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <!-- jsPDF for PDF Export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <!-- Arabic Font Support for jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/pdfjs-dist@3.11.174/build/pdf.min.js"></script>
    <link rel="stylesheet" href="styel.css">

</head>
<body>
    <!-- Toast Container -->
    <div id="toast-container"></div>
    
    <!-- Loading Spinner -->
    <div id="loading-spinner" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 10000; justify-content: center; align-items: center;">
        <div style="text-align: center; color: white;">
            <div class="spinner-border" role="status" style="width: 3rem; height: 3rem;">
                <span class="visually-hidden">ุฌุงุฑู ุงูุชุญููู...</span>
            </div>
            <p style="margin-top: 15px; font-size: 18px;">ุฌุงุฑู ุงูุชุญููู ูู ุงูุณุญุงุจุฉ...</p>
        </div>
    </div>
    
    <header>
        <div class="header-content">
            <div class="logo">
                <i class="fas fa-wallet"></i>
                ูููุณูุง
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home"><i class="fas fa-home"></i> ุงูุฑุฆูุณูุฉ</a></li>
                    <li><a href="#" class="nav-link" data-page="deposits"><i class="fas fa-list"></i> ุงูุณุฌู</a></li>
                    <li><a href="#" class="nav-link" data-page="admin"><i class="fas fa-cog"></i> ุงูุฅุฏุงุฑุฉ</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main>
        <div class="container">
            <section id="home" class="page active">
                <div class="card balance-card" data-aos="fade-up">
                    <h2 class="card-header" style="border: none; color: var(--dark-color); justify-content: center;">
                        <i class="fas fa-chart-line"></i>
                        ุงูุฑุตูุฏ ุงูุฅุฌูุงูู
                    </h2>
                    <div class="balance-amount" id="total-balance">
                        <i class="fas fa-pound-sign"></i> 0
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                        <button class="btn" onclick="showPage('add-deposit'); document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));">
                            <i class="fas fa-plus"></i> ุฅูุฏุงุน ุฌุฏูุฏ
                        </button>
                        <button class="btn" style="background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);" onclick="showPage('add-withdrawal'); document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));">
                            <i class="fas fa-minus"></i> ุณุญุจ ุฌุฏูุฏ
                        </button>
                    </div>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="100">
                    <h2 class="card-header">
                        <i class="fas fa-chart-bar"></i>
                        ุงูุฅุญุตุงุฆูุงุช ูุงูุฑุตูุฏ ุงูุฅุฌูุงูู
                    </h2>
                    <div class="stats">
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="100">
                            <i class="fas fa-wallet" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-color);"></i>
                            <div class="stat-value" id="home-total-balance">0</div>
                            <div class="stat-label">ุงูุฑุตูุฏ ุงูุญุงูู</div>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="150">
                            <i class="fas fa-arrow-down" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--success-color);"></i>
                            <div class="stat-value" id="home-total-deposits-amount">0</div>
                            <div class="stat-label">ุฅุฌูุงูู ุงูุฅูุฏุงุนุงุช</div>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="200">
                            <i class="fas fa-arrow-up" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--danger-color);"></i>
                            <div class="stat-value" id="home-total-expenses-amount">0</div>
                            <div class="stat-label">ุฅุฌูุงูู ุงููุตุฑููุงุช</div>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="250">
                            <i class="fas fa-sort-amount-down" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #8b5cf6;"></i>
                            <div class="stat-value" id="total-deposits">0</div>
                            <div class="stat-label">ุนุฏุฏ ุงูุฅูุฏุงุนุงุช</div>
                        </div>
                        <div class="stat-item" data-aos="zoom-in" data-aos-delay="300">
                            <i class="fas fa-shopping-cart" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: #f59e0b;"></i>
                            <div class="stat-value" id="total-expenses">0</div>
                            <div class="stat-label">ุนุฏุฏ ุงููุตุฑููุงุช</div>
                        </div>
                    </div>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="150">
                    <h2 class="card-header">
                        <i class="fas fa-history"></i>
                        ุขุฎุฑ ุงูุฅูุฏุงุนุงุช
                    </h2>
                    <div id="recent-deposits"></div>
                </div>

                <div class="card" data-aos="fade-up" data-aos-delay="175">
                    <h2 class="card-header">
                        <i class="fas fa-hand-holding-usd"></i>
                        ุขุฎุฑ ุงูุณุญูุจุงุช
                    </h2>
                    <div id="recent-withdrawals"></div>
                </div>

                <!-- Charts Section -->
                <div class="charts-section" data-aos="fade-up" data-aos-delay="200">
                    <div class="chart-card">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-pie" style="color: var(--primary-color);"></i>
                            ุชูุฒูุน ุงูุฅูุฏุงุนุงุช ุญุณุจ ุงูุญุงูุฉ
                        </h3>
                        <canvas id="depositsStatusChart"></canvas>
                    </div>
                    <div class="chart-card">
                        <h3 class="chart-title">
                            <i class="fas fa-chart-line" style="color: var(--success-color);"></i>
                            ุงูุฅูุฏุงุนุงุช ูุงููุตุฑููุงุช
                        </h3>
                        <canvas id="depositsVsExpensesChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="add-deposit" class="page">
                <div class="card" data-aos="fade-up">
                    <h2 class="card-header">
                        <i class="fas fa-plus-circle"></i>
                        ุฅุถุงูุฉ ุฅูุฏุงุน ุฌุฏูุฏ
                    </h2>
                    <form id="deposit-form">
                        <div class="form-group">
                            <label for="depositor-name"><i class="fas fa-user"></i> ุงุณู ุงูุนุถู</label>
                            <input type="text" id="depositor-name" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู" required>
                        </div>
                        <div class="form-group">
                            <label for="depositor-phone"><i class="fas fa-phone"></i> ุฑูู ุงููุงุชู ุงููุญูู ููู</label>
                            <input type="tel" id="depositor-phone" placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู" required>
                        </div>
                        <div class="form-group">
                            <label for="deposit-amount"><i class="fas fa-money-bill-wave"></i> ุงููุจูุบ (ุฌููู)</label>
                            <input type="number" id="deposit-amount" min="1" placeholder="ุฃุฏุฎู ุงููุจูุบ" required>
                        </div>
                        <div class="form-group">
                            <label for="deposit-proof"><i class="fas fa-image"></i> ุตูุฑุฉ ุฅุซุจุงุช ุงูุชุญููู</label>
                            <input type="file" id="deposit-proof" accept="image/*" required>
                            <img id="proof-preview" class="image-preview" alt="ูุนุงููุฉ ุงูุตูุฑุฉ">
                        </div>
                        <div class="wallet-info">
                            <p><i class="fas fa-mobile-alt"></i> ุฑูู ุงููุญูุธุฉ:</p>
                            <p class="wallet-number">01097612534</p>
                            <p><i class="fas fa-info-circle"></i> ูุฑุฌู ุฅุฑูุงู ุตูุฑุฉ ุฅุซุจุงุช ุงูุชุญููู ุจุนุฏ ุงูุฅูุฏุงุน</p>
                        </div>
                        <button type="submit"><i class="fas fa-paper-plane"></i> ุฅุถุงูุฉ ุงูุฅูุฏุงุน</button>
                    </form>
                </div>
            </section>

            <section id="add-withdrawal" class="page">
                <div class="card" data-aos="fade-up">
                    <h2 class="card-header">
                        <i class="fas fa-minus-circle"></i>
                        ุฅุถุงูุฉ ุนูููุฉ ุณุญุจ ุฌุฏูุฏุฉ
                    </h2>
                    <form id="withdrawal-form">
                        <div class="form-group">
                            <label for="withdrawal-name"><i class="fas fa-user"></i> ุงุณู ุงูุนุถู</label>
                            <input type="text" id="withdrawal-name" placeholder="ุฃุฏุฎู ุงุณูู ุงููุงูู" required>
                        </div>
                        <div class="form-group">
                            <label for="withdrawal-phone"><i class="fas fa-phone"></i> ุฑูู ุงููุงุชู ุงููุญูู ุฅููู</label>
                            <input type="tel" id="withdrawal-phone" placeholder="ุฃุฏุฎู ุฑูู ุงููุงุชู" required>
                        </div>
                        <div class="form-group">
                            <label for="withdrawal-amount"><i class="fas fa-money-bill-wave"></i> ุงููุจูุบ (ุฌููู)</label>
                            <input type="number" id="withdrawal-amount" min="1" placeholder="ุฃุฏุฎู ุงููุจูุบ" required>
                        </div>
                        <div class="form-group">
                            <label for="withdrawal-reason"><i class="fas fa-comment"></i> ุณุจุจ ุงูุณุญุจ</label>
                            <textarea id="withdrawal-reason" placeholder="ุงูุชุจ ุณุจุจ ุงูุณุญุจ (ุงุฎุชูุงุฑู)"></textarea>
                        </div>
                        <div class="wallet-info" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%); border-right: 4px solid var(--danger-color);">
                            <p><i class="fas fa-exclamation-triangle"></i> ุชูุจูู:</p>
                            <p style="color: var(--danger-color); font-weight: 600;">ุณูุชู ูุฑุงุฌุนุฉ ุทูุจ ุงูุณุญุจ ูุงูููุงููุฉ ุนููู ูู ูุจู ุงูุฅุฏุงุฑุฉ</p>
                        </div>
                        <button type="submit" style="background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);"><i class="fas fa-paper-plane"></i> ุชูุฏูู ุทูุจ ุงูุณุญุจ</button>
                    </form>
                </div>
            </section>

            <section id="deposits" class="page">
                <div style="display: grid; grid-template-columns: 1fr; gap: 2rem; margin-bottom: 2rem;">
                    <div class="card" data-aos="fade-up">
                        <h2 class="card-header"><i class="fas fa-arrow-down"></i> ุณุฌู ุงูุฅูุฏุงุนุงุช</h2>
                        
                        <!-- Search and Filter -->
                        <div class="search-filter-section">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="deposits-search" placeholder="ุงุจุญุซ ุนู ุงุณู ุฃู ุฑูู ูุงุชู..." onkeyup="filterDeposits()">
                            </div>
                            <div class="filter-group">
                                <button class="filter-btn active" onclick="filterByStatus('all')" data-status="all"><i class="fas fa-list"></i> ุงููู</button>
                                <button class="filter-btn" onclick="filterByStatus('pending')" data-status="pending"><i class="fas fa-clock"></i> ูุนูู</button>
                                <button class="filter-btn" onclick="filterByStatus('approved')" data-status="approved"><i class="fas fa-check"></i> ููุจูู</button>
                                <button class="filter-btn" onclick="filterByStatus('rejected')" data-status="rejected"><i class="fas fa-times"></i> ูุฑููุถ</button>
                            </div>
                        </div>
                        
                        <div class="deposits-container">
                            <table class="deposits-table">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('deposits-list', 0)"><i class="fas fa-user"></i> ุงูุงุณู <span class="sort-indicator">โ</span></th>
                                        <th onclick="sortTable('deposits-list', 1)"><i class="fas fa-phone"></i> ุงููุงุชู <span class="sort-indicator">โ</span></th>
                                        <th onclick="sortTable('deposits-list', 2)"><i class="fas fa-coins"></i> ุงููุจูุบ <span class="sort-indicator">โ</span></th>
                                        <th onclick="sortTable('deposits-list', 3)"><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ <span class="sort-indicator">โ</span></th>
                                        <th><i class="fas fa-check-circle"></i> ุงูุญุงูุฉ</th>
                                    </tr>
                                </thead>
                                <tbody id="deposits-list"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card" data-aos="fade-up" data-aos-delay="100">
                        <h2 class="card-header"><i class="fas fa-hand-holding-usd"></i> ุณุฌู ุงูุณุญูุจุงุช</h2>
                        
                        <!-- Search and Filter -->
                        <div class="search-filter-section">
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="withdrawals-search" placeholder="ุงุจุญุซ ุนู ุงุณู ุฃู ุฑูู ูุงุชู..." onkeyup="filterWithdrawals()">
                            </div>
                            <div class="filter-group">
                                <button class="filter-btn active" onclick="filterWithdrawalsByStatus('all')" data-status="all"><i class="fas fa-list"></i> ุงููู</button>
                                <button class="filter-btn" onclick="filterWithdrawalsByStatus('pending')" data-status="pending"><i class="fas fa-clock"></i> ูุนูู</button>
                                <button class="filter-btn" onclick="filterWithdrawalsByStatus('approved')" data-status="approved"><i class="fas fa-check"></i> ููุจูู</button>
                                <button class="filter-btn" onclick="filterWithdrawalsByStatus('rejected')" data-status="rejected"><i class="fas fa-times"></i> ูุฑููุถ</button>
                            </div>
                        </div>
                        
                        <div class="deposits-container">
                            <table class="deposits-table">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-user"></i> ุงูุงุณู</th>
                                        <th><i class="fas fa-phone"></i> ุงููุงุชู</th>
                                        <th><i class="fas fa-coins"></i> ุงููุจูุบ</th>
                                        <th><i class="fas fa-comment"></i> ุงูุณุจุจ</th>
                                        <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                        <th><i class="fas fa-check-circle"></i> ุงูุญุงูุฉ</th>
                                    </tr>
                                </thead>
                                <tbody id="withdrawals-list"></tbody>
                            </table>
                        </div>
                    </div>
                    
                    <div class="card" data-aos="fade-up" data-aos-delay="200">
                        <h2 class="card-header"><i class="fas fa-arrow-up"></i> ุณุฌู ุงููุตุฑููุงุช</h2>
                        <div style="overflow-x: auto;">
                            <table class="deposits-table">
                                <thead>
                                    <tr>
                                        <th><i class="fas fa-pen"></i> ุงููุตู</th>
                                        <th><i class="fas fa-tag"></i> ุงููุฆุฉ</th>
                                        <th><i class="fas fa-coins"></i> ุงููุจูุบ</th>
                                        <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                    </tr>
                                </thead>
                                <tbody id="expenses-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <section id="admin" class="page">
                <div id="admin-login-section" class="card admin-login" data-aos="zoom-in">
                    <h2 class="card-header"><i class="fas fa-lock"></i> ุชุณุฌูู ุฏุฎูู ุงูุฅุฏุงุฑุฉ</h2>
                    <form id="admin-login-form">
                        <div class="form-group">
                            <label for="admin-username"><i class="fas fa-user"></i> ุงุณู ุงููุณุชุฎุฏู</label>
                            <input type="text" id="admin-username" placeholder="ุฃุฏุฎู ุงุณู ุงููุณุชุฎุฏู" required>
                        </div>
                        <div class="form-group">
                            <label for="admin-password"><i class="fas fa-key"></i> ูููุฉ ุงููุฑูุฑ</label>
                            <input type="password" id="admin-password" placeholder="ุฃุฏุฎู ูููุฉ ุงููุฑูุฑ" required>
                        </div>
                        <button type="submit"><i class="fas fa-sign-in-alt"></i> ุชุณุฌูู ุงูุฏุฎูู</button>
                    </form>
                </div>

                <div id="admin-dashboard" style="display: none;">
                    <div style="text-align: left; margin-bottom: 1.5rem;">
                        <button class="btn btn-danger" onclick="adminLogout();" style="background-color: var(--danger-color); border: none; padding: 0.6rem 1.2rem; font-size: 0.9rem;">
                            <i class="fas fa-sign-out-alt"></i> ุชุณุฌูู ุงูุฎุฑูุฌ
                        </button>
                    </div>

                    <div class="card admin-section" data-aos="fade-up">
                        <h2 class="card-header"><i class="fas fa-chart-bar"></i> ุงูุฅุญุตุงุฆูุงุช</h2>
                        <div class="stats">
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="300">
                                <i class="fas fa-arrow-down" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--success-color);"></i>
                                <div class="stat-value" id="admin-total-deposits">0</div>
                                <div class="stat-label">ุฅุฌูุงูู ุงูุฅูุฏุงุนุงุช</div>
                            </div>
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="400">
                                <i class="fas fa-arrow-up" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--danger-color);"></i>
                                <div class="stat-value" id="admin-total-expenses">0</div>
                                <div class="stat-label">ุฅุฌูุงูู ุงููุตุฑููุงุช</div>
                            </div>
                            <div class="stat-item" data-aos="zoom-in" data-aos-delay="500">
                                <i class="fas fa-wallet" style="font-size: 1.5rem; margin-bottom: 0.5rem; color: var(--primary-color);"></i>
                                <div class="stat-value" id="admin-current-balance">0</div>
                                <div class="stat-label">ุงูุฑุตูุฏ ุงูุญุงูู</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card admin-section" data-aos="fade-up" data-aos-delay="100">
                        <h2 class="card-header"><i class="fas fa-cash-register"></i> ุฅุถุงูุฉ ูุตุฑููุงุช</h2>
                        <form id="expense-form">
                            <div class="form-group">
                                <label for="expense-description"><i class="fas fa-pen"></i> ูุตู ุงููุตุฑูู</label>
                                <input type="text" id="expense-description" placeholder="ุฃุฏุฎู ูุตู ุงููุตุฑูู" required>
                            </div>
                            <div class="form-group">
                                <label for="expense-category"><i class="fas fa-tag"></i> ุงูุชุตููู</label>
                                <input type="text" id="expense-category" placeholder="ุฃุฏุฎู ุงูุชุตููู " required>
                            </div>
                            <div class="form-group">
                                <label for="expense-amount"><i class="fas fa-money-bill-wave"></i> ุงููุจูุบ (ุฌููู)</label>
                                <input type="number" id="expense-amount" min="1" placeholder="ุฃุฏุฎู ุงููุจูุบ" required>
                            </div>
                            <button type="submit" class="btn-danger"><i class="fas fa-plus"></i> ุฅุถุงูุฉ ุงููุตุฑูู</button>
                        </form>
                    </div>
                    
                    <div class="card admin-section" data-aos="fade-up" data-aos-delay="150">
                        <h2 class="card-header" style="margin-bottom: 0;">
                            <i class="fas fa-tasks"></i>
                            <span id="current-tab-title">ุฅุฏุงุฑุฉ ุงูุฅูุฏุงุนุงุช</span>
                        </h2>
                        <div class="admin-tabs">
                            <div class="tab-headers">
                                <button class="tab-header active" onclick="switchAdminTab('deposits')" data-title="ุฅุฏุงุฑุฉ ุงูุฅูุฏุงุนุงุช">
                                    <i class="fas fa-arrow-down"></i> ุงูุฅูุฏุงุนุงุช
                                </button>
                                <button class="tab-header" onclick="switchAdminTab('expenses')" data-title="ุฅุฏุงุฑุฉ ุงููุตุฑููุงุช">
                                    <i class="fas fa-shopping-cart"></i> ุงููุตุฑููุงุช
                                </button>
                                <button class="tab-header" onclick="switchAdminTab('withdrawals')" data-title="ุฅุฏุงุฑุฉ ุงูุณุญูุจุงุช">
                                    <i class="fas fa-hand-holding-usd"></i> ุงูุณุญูุจุงุช
                                </button>
                            </div>
                            
                            <div class="tab-content">
                                <!-- ุฅุฏุงุฑุฉ ุงูุฅูุฏุงุนุงุช -->
                                <div id="admin-tab-deposits" class="tab-pane active">
                                    <div class="admin-filters">
                                        <div class="search-box" style="flex: 1;">
                                            <i class="fas fa-search"></i>
                                            <input type="text" id="admin-deposits-search" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุฑูู ุงููุงุชู..." onkeyup="filterAdminDeposits()">
                                        </div>
                                        <div class="filter-buttons">
                                            <button class="filter-btn active" onclick="filterAdminDepositsByStatus('all')">
                                                <i class="fas fa-list"></i> ุงููู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminDepositsByStatus('pending')">
                                                <i class="fas fa-clock"></i> ูุนูู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminDepositsByStatus('approved')">
                                                <i class="fas fa-check-circle"></i> ููุจูู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminDepositsByStatus('rejected')">
                                                <i class="fas fa-times-circle"></i> ูุฑููุถ
                                            </button>
                                        </div>
                                    </div>
                                    <div style="overflow-x: auto;">
                                        <table class="deposits-table">
                                            <thead>
                                                <tr>
                                                    <th><i class="fas fa-user"></i> ุงูุงุณู</th>
                                                    <th><i class="fas fa-phone"></i> ุงููุงุชู</th>
                                                    <th><i class="fas fa-coins"></i> ุงููุจูุบ</th>
                                                    <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                                    <th><i class="fas fa-check-circle"></i> ุงูุญุงูุฉ</th>
                                                    <th><i class="fas fa-cog"></i> ุงูุฅุฌุฑุงุกุงุช</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-deposits-list"></tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- ุฅุฏุงุฑุฉ ุงููุตุฑููุงุช -->
                                <div id="admin-tab-expenses" class="tab-pane">
                                    <div class="admin-filters">
                                        <div class="search-box" style="flex: 1;">
                                            <i class="fas fa-search"></i>
                                            <input type="text" id="admin-expenses-search" placeholder="ุจุญุซ ุจุงููุตู ุฃู ุงููุฆุฉ..." onkeyup="filterAdminExpenses()">
                                        </div>
                                    </div>
                                    <div style="overflow-x: auto;">
                                        <table class="deposits-table">
                                            <thead>
                                                <tr>
                                                    <th><i class="fas fa-pen"></i> ุงููุตู</th>
                                                    <th><i class="fas fa-tag"></i> ุงููุฆุฉ</th>
                                                    <th><i class="fas fa-coins"></i> ุงููุจูุบ</th>
                                                    <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                                    <th><i class="fas fa-cog"></i> ุงูุฅุฌุฑุงุกุงุช</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-expenses-list"></tbody>
                                        </table>
                                    </div>
                                </div>
                                
                                <!-- ุฅุฏุงุฑุฉ ุงูุณุญูุจุงุช -->
                                <div id="admin-tab-withdrawals" class="tab-pane">
                                    <div class="admin-filters">
                                        <div class="search-box" style="flex: 1;">
                                            <i class="fas fa-search"></i>
                                            <input type="text" id="admin-withdrawals-search" placeholder="ุจุญุซ ุจุงูุงุณู ุฃู ุฑูู ุงููุงุชู..." onkeyup="filterAdminWithdrawals()">
                                        </div>
                                        <div class="filter-buttons">
                                            <button class="filter-btn active" onclick="filterAdminWithdrawalsByStatus('all')">
                                                <i class="fas fa-list"></i> ุงููู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminWithdrawalsByStatus('pending')">
                                                <i class="fas fa-clock"></i> ูุนูู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminWithdrawalsByStatus('approved')">
                                                <i class="fas fa-check-circle"></i> ููุจูู
                                            </button>
                                            <button class="filter-btn" onclick="filterAdminWithdrawalsByStatus('rejected')">
                                                <i class="fas fa-times-circle"></i> ูุฑููุถ
                                            </button>
                                        </div>
                                    </div>
                                    <div style="overflow-x: auto;">
                                        <table class="deposits-table">
                                            <thead>
                                                <tr>
                                                    <th><i class="fas fa-user"></i> ุงูุงุณู</th>
                                                    <th><i class="fas fa-phone"></i> ุงููุงุชู</th>
                                                    <th><i class="fas fa-coins"></i> ุงููุจูุบ</th>
                                                    <th><i class="fas fa-comment"></i> ุงูุณุจุจ</th>
                                                    <th><i class="fas fa-calendar"></i> ุงูุชุงุฑูุฎ</th>
                                                    <th><i class="fas fa-check-circle"></i> ุงูุญุงูุฉ</th>
                                                    <th><i class="fas fa-cog"></i> ุงูุฅุฌุฑุงุกุงุช</th>
                                                </tr>
                                            </thead>
                                            <tbody id="admin-withdrawals-list"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card admin-section" data-aos="fade-up" data-aos-delay="75">
                        <h2 class="card-header"><i class="fas fa-print"></i> ุทุจุงุนุฉ ุงูุชูุงุฑูุฑ</h2>
                        <div style="display: flex; gap: 1rem; flex-wrap: wrap; padding: 1rem;">
                            <button class="btn" onclick="printBalanceReport()" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);">
                                <i class="fas fa-file-invoice-dollar"></i> ุชูุฑูุฑ ุงูุฑุตูุฏ ุงููุงูู
                            </button>
                            <button class="btn" onclick="printDepositsReport()" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, var(--success-color) 0%, #059669 100%);">
                                <i class="fas fa-file-download"></i> ุชูุฑูุฑ ุงูุฅูุฏุงุนุงุช
                            </button>
                            <button class="btn" onclick="printExpensesWithdrawalsReport()" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, var(--danger-color) 0%, #dc2626 100%);">
                                <i class="fas fa-file-upload"></i> ุชูุฑูุฑ ุงููุตุฑููุงุช ูุงูุณุญูุจุงุช
                            </button>
                        </div>
                    </div>
                    
                    <div class="card admin-section" data-aos="fade-up" data-aos-delay="50" style="border: 2px solid var(--danger-color);">
                        <h2 class="card-header" style="background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%); color: var(--danger-color);">
                            <i class="fas fa-exclamation-triangle"></i> ููุทูุฉ ุงูุฎุทุฑ
                        </h2>
                        <div style="padding: 1.5rem;">
                            <p style="color: var(--gray-color); margin-bottom: 1rem;">
                                <i class="fas fa-info-circle"></i> ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุณูุคุฏู ููุณุญ ูู ุงูุฅูุฏุงุนุงุช ูุงููุตุฑููุงุช ูุงูุณุญูุจุงุช ุจุดูู ููุงุฆู ููุง ูููู ุงูุชุฑุงุฌุน.
                            </p>
                            <button class="btn" onclick="deleteAllData()" style="background: linear-gradient(135deg, var(--danger-color) 0%, #b91c1c 100%); width: auto;">
                                <i class="fas fa-trash-alt"></i> ุญุฐู ุฌููุน ุงูุจูุงูุงุช
                            </button>
                        </div>
                    </div>

                   
                </div>
            </section>
        </div>
    </main>

    <footer>
        <div class="container">
            <p><i class="fas fa-wallet"></i> ูููุณูุง - ุงููุญูุธุฉ ุงูุฌูุงุนูุฉ<br><small>&copy; 2025 ุฌููุน ุงูุญููู ูุญููุธุฉ</small></p>
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init({duration: 800, easing: 'ease-in-out-cubic', once: true, offset: 100});

        // ุฏุงูุฉ ูุฏุนู ุงููุตูุต ุงูุนุฑุจูุฉ ูู PDF
        function reverseArabicText(text) {
            // ูุฐู ุฏุงูุฉ ูุณุงุนุฏุฉ ูุนูุณ ุงููุต ุงูุนุฑุจู
            // ูู ุงููุงูุนุ jsPDF ูุชุนุงูู ูุน ุงูุนุฑุจูุฉ ูุจุงุดุฑุฉ
            return text;
        }

        // ุชุณุฌูู ุฎุท Arial ูุฏุนู ุงูุนุฑุจูุฉ
        if (typeof window.jsPDF !== 'undefined') {
            const { jsPDF } = window.jspdf;
            // ุงุณุชุฎุฏุงู font helvetica ูุจุฏูู ุขูู
        }

        let appData = {deposits: [], expenses: [], withdrawals: [], adminLoggedIn: false, adminCredentials: {username: "admin", password: "admin123"}};

        // ========== ูุธุงู Toast Notifications ==========
        function showToast(message, type = 'success') {
            console.log('๐ showToast called:', message, type);
            const container = document.getElementById('toast-container');
            console.log('๐ฆ Container element:', container);
            if (!container) {
                console.error('โ Toast container not found!');
                return;
            }
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.style.opacity = '0';
            toast.style.transform = 'translateX(100%)';
            
            const icons = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            };
            
            toast.innerHTML = `
                <i class="toast-icon ${icons[type]}"></i>
                <div class="toast-content">
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(toast);
            console.log('โ Toast added to container');
            
            // Trigger animation
            setTimeout(() => {
                toast.style.transition = 'all 0.3s ease-out';
                toast.style.opacity = '1';
                toast.style.transform = 'translateX(0)';
            }, 10);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 5000);
        }

        // ========== ุฅุนุฏุงุฏุงุช Google Sheets ู Telegram ==========
        const GOOGLE_SHEETS_CONFIG = {
            enabled: true, // โ ููุนูู
            scriptUrl: 'https://script.google.com/macros/s/AKfycbwXnHX6aquAEjY0G2tZtq6FmmNVECtsICGdyaYPLpAZmjjeBhKcPQLnVjlNojPhhRrh/exec'
        };

        const TELEGRAM_CONFIG = {
            enabled: true,
            botToken: '8299247400:AAGOPKCq13E5bqIEwMjjl-wKm7cAIzaJnKo',
            chatId: '7639421086'
        };

        // ูุชุบูุฑ ููุชุญููู
        let isLoading = false;

        // ========== ุฏูุงู Google Sheets (ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฑุฆูุณูุฉ) ==========
        
        // ุฌูุจ ุฌููุน ุงูุจูุงูุงุช ูู Google Sheets
        async function fetchDataFromGoogleSheets() {
            if (!GOOGLE_SHEETS_CONFIG.enabled || !GOOGLE_SHEETS_CONFIG.scriptUrl) {
                console.log('โ๏ธ Google Sheets ุบูุฑ ููุนู - ุงุณุชุฎุฏุงู LocalStorage');
                return null;
            }

            showLoading(true);
            try {
                // ุงุณุชุฎุฏุงู GET ุจุฏูุงู ูู POST ูุชุฌูุจ ูุดุงูู CORS
                const payload = {action: 'getAll'};
                const url = new URL(GOOGLE_SHEETS_CONFIG.scriptUrl);
                url.searchParams.append('data', JSON.stringify(payload));
                
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    console.log('โ ุชู ุฌูุจ ุงูุจูุงูุงุช ูู Google Sheets');
                    return result.data;
                } else {
                    console.error('โ ุฎุทุฃ:', result.message);
                    showToast('ูุดู ุฌูุจ ุงูุจูุงูุงุช ูู ุงูุณุญุงุจุฉ', 'error');
                    return null;
                }
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจู Google Sheets:', error);
                showToast('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจูุงุนุฏุฉ ุงูุจูุงูุงุช', 'error');
                return null;
            } finally {
                showLoading(false);
            }
        }

        // ุฅุฑุณุงู ุจูุงูุงุช ุฅูู Google Sheets
        async function sendToGoogleSheets(action, data) {
            if (!GOOGLE_SHEETS_CONFIG.enabled || !GOOGLE_SHEETS_CONFIG.scriptUrl) {
                console.log('โ๏ธ Google Sheets ุบูุฑ ููุนู');
                return {status: 'error', message: 'Google Sheets not enabled'};
            }

            showLoading(true);
            try {
                const payload = {action: action, ...data};
                
                // ุงุณุชุฎุฏุงู GET ุจุฏูุงู ูู POST ูุชุฌูุจ ูุดุงูู CORS
                const url = new URL(GOOGLE_SHEETS_CONFIG.scriptUrl);
                url.searchParams.append('data', JSON.stringify(payload));
                
                const response = await fetch(url.toString(), {
                    method: 'GET',
                    redirect: 'follow'
                });
                
                const result = await response.json();
                return result;
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุจูุงูุงุช:', error);
                return {status: 'error', message: error.message};
            } finally {
                showLoading(false);
            }
        }

        // ุนุฑุถ/ุฅุฎูุงุก ุดุงุดุฉ ุงูุชุญููู
        function showLoading(show) {
            isLoading = show;
            const spinner = document.getElementById('loading-spinner');
            if (spinner) {
                spinner.style.display = show ? 'flex' : 'none';
            }
        }

        // ========== ุฏูุงู Telegram ==========
        async function sendTelegramNotification(message) {
            if (!TELEGRAM_CONFIG.enabled || !TELEGRAM_CONFIG.botToken || !TELEGRAM_CONFIG.chatId) {
                console.log('Telegram ุบูุฑ ููุนู');
                return;
            }

            console.log('๐ ุฌุงุฑู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุฅูู Telegram...');
            console.log('Bot Token:', TELEGRAM_CONFIG.botToken.substring(0, 10) + '...');
            console.log('Chat ID:', TELEGRAM_CONFIG.chatId);

            try {
                const url = `https://api.telegram.org/bot${TELEGRAM_CONFIG.botToken}/sendMessage`;
                const payload = {
                    chat_id: TELEGRAM_CONFIG.chatId,
                    text: message.trim(),
                    parse_mode: 'HTML'
                };
                
                console.log('๐ค ุงูุจูุงูุงุช ุงููุฑุณูุฉ:', payload);
                
                const response = await fetch(url, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                console.log('๐ฅ ุงูุฑุฏ ูู Telegram:', result);
                
                if (result.ok) {
                    console.log('โ ุชู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุฅูู Telegram ุจูุฌุงุญ');
                } else {
                    console.error('โ ุฎุทุฃ ูู Telegram API:', result);
                    showToast('ูุดู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ: ' + (result.description || 'ุฎุทุฃ ุบูุฑ ูุนุฑูู'), 'error');
                }
            } catch (error) {
                console.error('โ ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ ุฅูู Telegram:', error);
                showToast('ุฎุทุฃ ูู ุงูุงุชุตุงู ุจู Telegram: ' + error.message, 'error');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            loadData();
            setupEventListeners();
            checkAdminLoginStatus();
            updateUI();
        });

        // ุชุญููู ุงูุจูุงูุงุช ูู Google Sheets ุฃู LocalStorage
        async function loadData() {
            // ูุญุงููุฉ ุฌูุจ ุงูุจูุงูุงุช ูู Google Sheets
            const cloudData = await fetchDataFromGoogleSheets();
            
            if (cloudData) {
                // ุชุญููู ุงูุจูุงูุงุช ูู ุงูุนุฑุจูุฉ ุฅูู ุงูุฅูุฌููุฒูุฉ
                appData.deposits = (cloudData.deposits || []).map(d => ({
                    id: d.ID || d.id,
                    name: d.ุงูุงุณู || d.name || '',
                    phone: d.ุงููุงุชู || d.phone || '',
                    amount: parseAmount(d.ุงููุจูุบ || d.amount),
                    date: d.ุงูุชุงุฑูุฎ || d.date || '',
                    status: translateStatus(d.ุงูุญุงูุฉ || d.status || 'pending'),
                    proof: d.ุตูุฑุฉ_ุงูุชุญููู || d.proof || ''
                }));
                
                appData.expenses = (cloudData.expenses || []).map(e => ({
                    id: e.ID || e.id,
                    description: e.ุงููุตู || e.description || '',
                    category: e.ุงููุฆุฉ || e.category || '',
                    amount: parseAmount(e.ุงููุจูุบ || e.amount),
                    date: e.ุงูุชุงุฑูุฎ || e.date || ''
                }));
                
                appData.withdrawals = (cloudData.withdrawals || []).map(w => ({
                    id: w.ID || w.id,
                    date: w.ุงูุชุงุฑูุฎ || w.date || '',
                    name: w.ุงูุงุณู || w.name || '',
                    phone: w.ุงููุงุชู || w.phone || '',
                    amount: parseAmount(w.ุงููุจูุบ || w.amount),
                    reason: w.ุงูุณุจุจ || w.reason || '',
                    status: translateStatus(w.ุงูุญุงูุฉ || w.status || 'pending')
                }));
                
                // ุญูุธ ูุณุฎุฉ ูุญููุฉ ูู cache
                saveDataLocally();
                console.log('โ ุชู ุชุญููู ุงูุจูุงูุงุช ูู Google Sheets:', {
                    deposits: appData.deposits.length,
                    expenses: appData.expenses.length,
                    withdrawals: appData.withdrawals.length
                });
            } else {
                // ุงุณุชุฎุฏุงู ุงูุจูุงูุงุช ุงููุญููุฉ (LocalStorage) ูุฎุทุฉ ุงุญุชูุงุทูุฉ
                const savedData = localStorage.getItem('flosnaData');
                if (savedData) {
                    appData = JSON.parse(savedData);
                    if (!appData.withdrawals) {
                        appData.withdrawals = [];
                    }
                    console.log('โ๏ธ ุชู ุชุญููู ุงูุจูุงูุงุช ูู LocalStorage (ูุถุน ุนุฏู ุงูุงุชุตุงู)');
                }
            }
            
            // ุชูุธูู ุงูุตูุฑ ุงููุฏููุฉ
            cleanOldImages();
        }
        
        // ุชุญููู ุงูุญุงูุฉ ูู ุงูุนุฑุจูุฉ ุฅูู ุงูุฅูุฌููุฒูุฉ
        function translateStatus(arabicStatus) {
            const statusMap = {
                'ูุนูู': 'pending',
                'ููุจูู': 'approved',
                'ูุฑููุถ': 'rejected'
            };
            return statusMap[arabicStatus] || arabicStatus;
        }
        
        // ุชุญููู ุงููุจูุบ ุฅูู ุฑูู ุจุดูู ุขูู
        function parseAmount(value) {
            if (value === null || value === undefined || value === '') return 0;
            // ุฅุฒุงูุฉ ุฃู ุฃุญุฑู ุบูุฑ ุฑูููุฉ ูุชุญููู ุฅูู ุฑูู
            const cleaned = String(value).replace(/[^\d]/g, '');
            const num = parseInt(cleaned, 10);
            return isNaN(num) ? 0 : num;
        }

        // ุญูุธ ุงูุจูุงูุงุช ูุญููุงู (ููุณุฎุฉ ุงุญุชูุงุทูุฉ)
        function saveDataLocally() {
            try {
                localStorage.setItem('flosnaData', JSON.stringify(appData));
            } catch (error) {
                console.warn('โ๏ธ ุชุญุฐูุฑ: ูุดู ุญูุธ ุงูุจูุงูุงุช ูุญููุงู:', error);
            }
        }

        // ุชูุธูู ุงูุตูุฑ ูู ุงูุฅูุฏุงุนุงุช ุงูููุจููุฉ/ุงููุฑููุถุฉ
        function cleanOldImages() {
            let cleaned = false;
            appData.deposits.forEach(deposit => {
                if ((deposit.status === 'approved' || deposit.status === 'rejected') && deposit.proof) {
                    delete deposit.proof;
                    cleaned = true;
                }
            });
            
            if (cleaned) {
                saveDataLocally();
                console.log('โ ุชู ุชูุธูู ุงูุตูุฑ ุงููุฏููุฉ');
            }
        }

        // ุฏุงูุฉ ุงูุญูุธ ุงููุฏููุฉ (ููุชูุงูู ูุน ุงูููุฏ ุงููุฏูู)
        function saveData() {
            saveDataLocally();
        }

        function setupEventListeners() {
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    showPage(pageId);
                    document.querySelectorAll('.nav-link').forEach(item => item.classList.remove('active'));
                    this.classList.add('active');
                });
            });

            document.getElementById('deposit-form').addEventListener('submit', function(e) { e.preventDefault(); addDeposit(); });
            document.getElementById('deposit-proof').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(event) {
                        document.getElementById('proof-preview').src = event.target.result;
                        document.getElementById('proof-preview').style.display = 'block';
                    };
                    reader.readAsDataURL(file);
                }
            });

            document.getElementById('admin-login-form').addEventListener('submit', function(e) { e.preventDefault(); adminLogin(); });
            document.getElementById('expense-form').addEventListener('submit', function(e) { e.preventDefault(); addExpense(); });
            document.getElementById('withdrawal-form').addEventListener('submit', function(e) { e.preventDefault(); addWithdrawal(); });
        }

        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            AOS.refresh();
        }

        // ุฏุงูุฉ ูุถุบุท ุงูุตูุฑ
        function compressImage(file, maxWidth = 800, quality = 0.7) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = new Image();
                    img.onload = function() {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        const compressedData = canvas.toDataURL('image/jpeg', quality);
                        resolve(compressedData);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        async function addDeposit() {
            const name = document.getElementById('depositor-name').value;
            const phone = document.getElementById('depositor-phone').value;
            const amount = parseInt(document.getElementById('deposit-amount').value);
            const proofInput = document.getElementById('deposit-proof');
            
            if (!name || !phone || !amount || !proofInput.files[0]) { 
                showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู', 'warning'); 
                return; 
            }
            
            // Validate Egyptian phone number (11 digits)
            if (!/^\d{11}$/.test(phone)) { 
                showToast('ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู 11 ุฑูู ูุตุฑู', 'warning'); 
                return; 
            }

            const proofFile = proofInput.files[0];
            
            try {
                // ุถุบุท ุงูุตูุฑุฉ ูุจู ุงูุญูุธ
                const compressedImage = await compressImage(proofFile, 600, 0.6);
                
                const newDeposit = {
                    id: Date.now(), 
                    name: name, 
                    phone: phone, 
                    amount: amount,
                    date: new Date().toLocaleDateString('ar-EG'),
                    status: 'pending', 
                    proof: compressedImage
                };
                
                // ุฅุฑุณุงู ุฅูู Google Sheets (ุจุฏูู ุงูุตูุฑุฉ - ุงูุตูุฑุฉ ูุจูุฑุฉ ุฌุฏุงู ููู URL)
                const result = await sendToGoogleSheets('addDeposit', {
                    ID: newDeposit.id,
                    ุงูุงุณู: name,
                    ุงููุงุชู: phone,
                    ุงููุจูุบ: amount,
                    ุงูุชุงุฑูุฎ: newDeposit.date,
                    ุงูุญุงูุฉ: 'ูุนูู',
                    ุงูุตูุฑุฉ: '' // ุงูุตูุฑุฉ ูุญููุธุฉ ูู LocalStorage ููุท
                });
                
                if (result && result.status === 'success') {
                    // ุฅุถุงูุฉ ููุจูุงูุงุช ุงููุญููุฉ
                    appData.deposits.push(newDeposit);
                    saveDataLocally();
                    
                    updateUI();
                    document.getElementById('deposit-form').reset();
                    document.getElementById('proof-preview').style.display = 'none';
                    
                    // ุงุณุชุฏุนุงุก addActivity ุจุดูู ุขูู
                    if (typeof addActivity === 'function') {
                        addActivity('deposit', `ุชู ุฅุถุงูุฉ ุฅูุฏุงุน ุฌุฏูุฏ ูู ${name}`);
                    }
                    
                    showToast('ุชู ุฅุถุงูุฉ ุงูุฅูุฏุงุน ุจูุฌุงุญุ ุจุงูุชุธุงุฑ ุงูููุงููุฉ', 'success');
                    showPage('home');
                } else {
                    showToast('ูุดู ุฅุถุงูุฉ ุงูุฅูุฏุงุนุ ุญุงูู ูุฑุฉ ุฃุฎุฑู', 'error');
                }
            } catch (error) {
                console.error('ุฎุทุฃ ูู ุฅุถุงูุฉ ุงูุฅูุฏุงุน:', error);
                showToast('ุญุฏุซ ุฎุทุฃ ูู ูุนุงูุฌุฉ ุงูุฅูุฏุงุน', 'error');
            }
        }

        async function addWithdrawal() {
            const name = document.getElementById('withdrawal-name').value;
            const phone = document.getElementById('withdrawal-phone').value;
            const amount = parseInt(document.getElementById('withdrawal-amount').value);
            const reason = document.getElementById('withdrawal-reason').value;
            
            if (!name || !phone || !amount) { showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ', 'warning'); return; }
            
            // Validate Egyptian phone number (11 digits)
            if (!/^\d{11}$/.test(phone)) { showToast('ุฑูู ุงููุงุชู ูุฌุจ ุฃู ูููู 11 ุฑูู ูุตุฑู', 'warning'); return; }

            const newWithdrawal = {
                id: Date.now(), 
                name: name, 
                phone: phone, 
                amount: amount,
                reason: reason || 'ูุง ููุฌุฏ',
                date: new Date().toLocaleDateString('ar-EG'),
                status: 'pending'
            };
            
            // ุฅุฑุณุงู ุฅูู Google Sheets ุฃููุงู (ุงูุชุฑุชูุจ: ID | ุงูุงุณู | ุงููุงุชู | ุงููุจูุบ | ุงูุณุจุจ | ุงูุชุงุฑูุฎ | ุงูุญุงูุฉ)
            const result = await sendToGoogleSheets('addWithdrawal', {
                ID: newWithdrawal.id,
                ุงูุงุณู: name,
                ุงููุงุชู: phone,
                ุงููุจูุบ: amount,
                ุงูุณุจุจ: reason || 'ูุง ููุฌุฏ',
                ุงูุชุงุฑูุฎ: newWithdrawal.date,
                ุงูุญุงูุฉ: 'ูุนูู'
            });
            
            if (result && result.status === 'success') {
                appData.withdrawals.push(newWithdrawal);
                saveData();
            } else {
                showToast('ูุดู ุฅุถุงูุฉ ุทูุจ ุงูุณุญุจุ ุญุงูู ูุฑุฉ ุฃุฎุฑู', 'error');
                return;
            }
            
            updateUI();
            document.getElementById('withdrawal-form').reset();
            addActivity('withdrawal', `ุชู ุฅุถุงูุฉ ุทูุจ ุณุญุจ ุฌุฏูุฏ ูู ${name}`);
            showToast('ุชู ุชูุฏูู ุทูุจ ุงูุณุญุจ ุจูุฌุงุญุ ุจุงูุชุธุงุฑ ุงูููุงููุฉ ูู ุงูุฅุฏุงุฑุฉ', 'success');
            showPage('home');
        }

        function adminLogin() {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            if (username === appData.adminCredentials.username && password === appData.adminCredentials.password) {
                appData.adminLoggedIn = true;
                saveData();
                localStorage.setItem('adminLoggedIn', 'true');
                document.getElementById('admin-login-section').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                updateAdminDashboard();
            } else {
                showToast('ุงุณู ุงููุณุชุฎุฏู ุฃู ูููุฉ ุงููุฑูุฑ ุบูุฑ ุตุญูุญุฉ', 'error');
            }
        }

        function adminLogout() {
            appData.adminLoggedIn = false;
            localStorage.setItem('adminLoggedIn', 'false');
            saveData();
            document.getElementById('admin-login-section').style.display = 'block';
            document.getElementById('admin-dashboard').style.display = 'none';
            document.getElementById('admin-username').value = '';
            document.getElementById('admin-password').value = '';
        }

        function checkAdminLoginStatus() {
            const isLoggedIn = localStorage.getItem('adminLoggedIn') === 'true';
            if (isLoggedIn) {
                appData.adminLoggedIn = true;
                document.getElementById('admin-login-section').style.display = 'none';
                document.getElementById('admin-dashboard').style.display = 'block';
                updateAdminDashboard();
            }
        }

        async function addExpense() {
            console.log('๐ ุจุฏุก ุฅุถุงูุฉ ูุตุฑูู ุฌุฏูุฏ...');
            const description = document.getElementById('expense-description').value;
            const category = document.getElementById('expense-category').value;
            const amount = parseInt(document.getElementById('expense-amount').value);
            console.log('๐ ุงูุจูุงูุงุช:', {description, category, amount});
            if (!description || !amount) { showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู', 'warning'); return; }
            
            const newExpense = {id: Date.now(), description: description, category: category, amount: amount, date: new Date().toLocaleDateString('ar-EG')};
            
            // ุฅุฑุณุงู ุฅูู Google Sheets ุฃููุงู (ุงูุชุฑุชูุจ: ID | ุงููุตู | ุงููุฆุฉ | ุงููุจูุบ | ุงูุชุงุฑูุฎ)
            const result = await sendToGoogleSheets('addExpense', {
                ID: newExpense.id,
                ุงููุตู: description,
                ุงููุฆุฉ: category,
                ุงููุจูุบ: amount,
                ุงูุชุงุฑูุฎ: newExpense.date
            });
            
            console.log('๐ค ูุชูุฌุฉ ุฅุฑุณุงู ุงููุตุฑูู:', result);
            
            if (result && result.status === 'success') {
                appData.expenses.push(newExpense);
                saveData();
                console.log('๐พ ุชู ุญูุธ ุงููุตุฑูู ูุญููุงู');
            } else {
                console.error('โ ูุดู ุฅุฑุณุงู ุงููุตุฑูู:', result);
                showToast('ูุดู ุฅุถุงูุฉ ุงููุตุฑููุ ุญุงูู ูุฑุฉ ุฃุฎุฑู', 'error');
                return;
            }
            
            // ุฅุฑุณุงู ุฅุดุนุงุฑ Telegram
            console.log('๐ฑ ุฌุงุฑู ุชุญุถูุฑ ุฅุดุนุงุฑ Telegram ูููุตุฑูู...');
            const message = `<b>ูุตุฑูู ุฌุฏูุฏ</b>\n\n<b>ุงููุตู:</b> ${description}\n<b>ุงููุฆุฉ:</b> ${category}\n<b>ุงููุจูุบ:</b> ${amount} ุฌููู\n<b>ุงูุชุงุฑูุฎ:</b> ${newExpense.date}`;
            console.log('๐จ ูุต ุงูุฑุณุงูุฉ:', message);
            sendTelegramNotification(message).catch(error => {
                console.error('โ ุฎุทุฃ ูู ุฅุฑุณุงู ุงูุฅุดุนุงุฑ:', error);
            });
            
            updateUI();
            updateAdminDashboard();
            document.getElementById('expense-form').reset();
            showToast('ุชู ุฅุถุงูุฉ ุงููุตุฑูู ุจูุฌุงุญ', 'success');
        }

        function updateUI() {
            updateHomePage();
            updateDepositsPage();
            if (appData.adminLoggedIn) updateAdminDashboard();
        }

        function updateHomePage() {
            const totalDeposits = appData.deposits.filter(d => d.status === 'approved').reduce((sum, deposit) => sum + deposit.amount, 0);
            const totalExpenses = appData.expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalWithdrawals = appData.withdrawals.filter(w => w.status === 'approved').reduce((sum, withdrawal) => sum + withdrawal.amount, 0);
            const currentBalance = totalDeposits - totalExpenses - totalWithdrawals;
            
            document.getElementById('total-balance').innerHTML = `<i class="fas fa-pound-sign"></i> ${currentBalance}`;
            document.getElementById('total-deposits').textContent = appData.deposits.filter(d => d.status === 'approved').length;
            document.getElementById('total-expenses').textContent = appData.expenses.length;
            
            // ุชุญุฏูุซ ุงูุฅุญุตุงุฆูุงุช ูู ุงูุตูุญุฉ ุงูุฑุฆูุณูุฉ
            document.getElementById('home-total-balance').textContent = currentBalance;
            document.getElementById('home-total-deposits-amount').textContent = totalDeposits;
            document.getElementById('home-total-expenses-amount').textContent = totalExpenses;
            
            const recentDepositsContainer = document.getElementById('recent-deposits');
            const recentDeposits = appData.deposits.sort((a, b) => b.id - a.id).slice(0, 5);
            
            if (recentDeposits.length === 0) {
                recentDepositsContainer.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุฅูุฏุงุนุงุช ุญุชู ุงูุขู</p></div>';
            } else {
                let html = '';
                recentDeposits.forEach((deposit, index) => {
                    const statusIcon = deposit.status === 'approved' ? 'fa-check-circle' : deposit.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    html += `<div class="recent-deposit-item"><div class="deposit-name"><i class="fas fa-user-circle"></i> ${deposit.name}</div><div class="deposit-amount"><i class="fas fa-pound-sign"></i> ${deposit.amount}</div><div class="status-badge status-${deposit.status}"><i class="fas ${statusIcon}"></i>${getStatusText(deposit.status)}</div></div>`;
                });
                recentDepositsContainer.innerHTML = html;
            }
            
            // ุชุญุฏูุซ ุขุฎุฑ ุงูุณุญูุจุงุช
            const recentWithdrawalsContainer = document.getElementById('recent-withdrawals');
            const recentWithdrawals = appData.withdrawals.sort((a, b) => b.id - a.id).slice(0, 5);
            
            if (recentWithdrawals.length === 0) {
                recentWithdrawalsContainer.innerHTML = '<div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุณุญูุจุงุช ุญุชู ุงูุขู</p></div>';
            } else {
                let html = '';
                recentWithdrawals.forEach((withdrawal) => {
                    const statusIcon = withdrawal.status === 'approved' ? 'fa-check-circle' : withdrawal.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    html += `<div class="recent-deposit-item"><div class="deposit-name"><i class="fas fa-user-circle"></i> ${withdrawal.name}</div><div class="deposit-amount" style="color: var(--danger-color);"><i class="fas fa-minus"></i> ${withdrawal.amount}</div><div class="status-badge status-${withdrawal.status}"><i class="fas ${statusIcon}"></i>${getStatusText(withdrawal.status)}</div></div>`;
                });
                recentWithdrawalsContainer.innerHTML = html;
            }
        }

        function updateDepositsPage() {
            const depositsList = document.getElementById('deposits-list');
            if (appData.deposits.length === 0) {
                depositsList.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุฅูุฏุงุนุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.deposits.sort((a, b) => b.id - a.id).forEach(deposit => {
                    const statusIcon = deposit.status === 'approved' ? 'fa-check-circle' : deposit.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    const phone = deposit.phone || '-';
                    html += `<tr><td>${deposit.name}</td><td>${phone}</td><td>${deposit.amount}</td><td>${deposit.date}</td><td><span class="status-badge status-${deposit.status}"><i class="fas ${statusIcon}"></i>${getStatusText(deposit.status)}</span></td></tr>`;
                });
                depositsList.innerHTML = html;
            }
            
            const expensesList = document.getElementById('expenses-list');
            if (appData.expenses.length === 0) {
                expensesList.innerHTML = '<tr><td colspan="4"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ูุตุฑููุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.expenses.sort((a, b) => b.id - a.id).forEach(expense => {
                    const category = expense.category || 'ุบูุฑ ูุญุฏุฏ';
                    html += `<tr><td>${expense.description}</td><td>${category}</td><td>${expense.amount}</td><td>${expense.date}</td></tr>`;
                });
                expensesList.innerHTML = html;
            }
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุณุญูุจุงุช
            const withdrawalsList = document.getElementById('withdrawals-list');
            if (appData.withdrawals.length === 0) {
                withdrawalsList.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุณุญูุจุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.withdrawals.sort((a, b) => b.id - a.id).forEach(withdrawal => {
                    const statusIcon = withdrawal.status === 'approved' ? 'fa-check-circle' : withdrawal.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    html += `<tr><td>${withdrawal.name}</td><td>${withdrawal.phone}</td><td>${withdrawal.amount}</td><td>${withdrawal.reason}</td><td>${withdrawal.date}</td><td><span class="status-badge status-${withdrawal.status}"><i class="fas ${statusIcon}"></i>${getStatusText(withdrawal.status)}</span></td></tr>`;
                });
                withdrawalsList.innerHTML = html;
            }
        }

        function updateAdminDashboard() {
            const adminDepositsList = document.getElementById('admin-deposits-list');
            if (appData.deposits.length === 0) {
                adminDepositsList.innerHTML = '<tr><td colspan="6"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุฅูุฏุงุนุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.deposits.sort((a, b) => b.id - a.id).forEach(deposit => {
                    const statusIcon = deposit.status === 'approved' ? 'fa-check-circle' : deposit.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    const actionButtons = deposit.status === 'pending' ? `<button class="btn btn-primary btn-sm" onclick="updateDepositStatus(${deposit.id}, 'approved')"><i class="fas fa-check"></i> ูุจูู</button><button class="btn btn-danger btn-sm" onclick="updateDepositStatus(${deposit.id}, 'rejected')"><i class="fas fa-times"></i> ุฑูุถ</button>` : '';
                    const phone = deposit.phone || '-';
                    html += `<tr data-status="${deposit.status}"><td>${deposit.name}</td><td>${phone}</td><td>${deposit.amount}</td><td>${deposit.date}</td><td><span class="status-badge status-${deposit.status}"><i class="fas ${statusIcon}"></i>${getStatusText(deposit.status)}</span></td><td class="action-buttons">${actionButtons}<button class="btn btn-success btn-sm" onclick="viewProof(${appData.deposits.indexOf(deposit)})"><i class="fas fa-eye"></i> ุนุฑุถ</button><button class="btn btn-sm" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);" onclick="deleteDeposit(${deposit.id})"><i class="fas fa-trash"></i> ุญุฐู</button></td></tr>`;
                });
                adminDepositsList.innerHTML = html;
            }
            
            const totalDeposits = appData.deposits.filter(d => d.status === 'approved').reduce((sum, deposit) => sum + deposit.amount, 0);
            const totalExpenses = appData.expenses.reduce((sum, expense) => sum + expense.amount, 0);
            const totalWithdrawals = appData.withdrawals.filter(w => w.status === 'approved').reduce((sum, withdrawal) => sum + withdrawal.amount, 0);
            const currentBalance = totalDeposits - totalExpenses - totalWithdrawals;
            
            document.getElementById('admin-total-deposits').textContent = totalDeposits;
            document.getElementById('admin-total-expenses').textContent = totalExpenses;
            document.getElementById('admin-current-balance').textContent = currentBalance;
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงูุณุญูุจุงุช ูู ุงูุฅุฏุงุฑุฉ
            const adminWithdrawalsList = document.getElementById('admin-withdrawals-list');
            if (appData.withdrawals.length === 0) {
                adminWithdrawalsList.innerHTML = '<tr><td colspan="7"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ุณุญูุจุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.withdrawals.sort((a, b) => b.id - a.id).forEach(withdrawal => {
                    const statusIcon = withdrawal.status === 'approved' ? 'fa-check-circle' : withdrawal.status === 'rejected' ? 'fa-times-circle' : 'fa-clock';
                    const actionButtons = withdrawal.status === 'pending' ? `<button class="btn btn-primary btn-sm" onclick="updateWithdrawalStatus(${withdrawal.id}, 'approved')"><i class="fas fa-check"></i> ูุจูู</button><button class="btn btn-danger btn-sm" onclick="updateWithdrawalStatus(${withdrawal.id}, 'rejected')"><i class="fas fa-times"></i> ุฑูุถ</button>` : '';
                    html += `<tr data-status="${withdrawal.status}"><td>${withdrawal.name}</td><td>${withdrawal.phone}</td><td>${withdrawal.amount}</td><td>${withdrawal.reason}</td><td>${withdrawal.date}</td><td><span class="status-badge status-${withdrawal.status}"><i class="fas ${statusIcon}"></i>${getStatusText(withdrawal.status)}</span></td><td class="action-buttons">${actionButtons}<button class="btn btn-sm" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);" onclick="deleteWithdrawal(${withdrawal.id})"><i class="fas fa-trash"></i> ุญุฐู</button></td></tr>`;
                });
                adminWithdrawalsList.innerHTML = html;
            }
            
            // ุชุญุฏูุซ ูุงุฆูุฉ ุงููุตุฑููุงุช ูู ุงูุฅุฏุงุฑุฉ
            const adminExpensesList = document.getElementById('admin-expenses-list');
            if (appData.expenses.length === 0) {
                adminExpensesList.innerHTML = '<tr><td colspan="5"><div class="empty-state"><i class="fas fa-inbox"></i><p>ูุง ุชูุฌุฏ ูุตุฑููุงุช ุญุชู ุงูุขู</p></div></td></tr>';
            } else {
                let html = '';
                appData.expenses.sort((a, b) => b.id - a.id).forEach(expense => {
                    const category = expense.category || 'ุบูุฑ ูุญุฏุฏ';
                    html += `<tr><td>${expense.description}</td><td>${category}</td><td>${expense.amount}</td><td>${expense.date}</td><td class="action-buttons"><button class="btn btn-sm" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);" onclick="deleteExpense(${expense.id})"><i class="fas fa-trash"></i> ุญุฐู</button></td></tr>`;
                });
                adminExpensesList.innerHTML = html;
            }
        }

        async function updateDepositStatus(id, status) {
            const deposit = appData.deposits.find(d => d.id === id);
            if (deposit) { 
                const oldStatus = deposit.status;
                deposit.status = status;
                
                // ุญุฐู ุงูุตูุฑุฉ ุจุนุฏ ุงููุจูู/ุงูุฑูุถ ูุชูููุฑ ุงููุณุงุญุฉ
                if (status === 'approved' || status === 'rejected') {
                    delete deposit.proof;
                }
                
                // ุฅุฑุณุงู ุงูุชุญุฏูุซ ุฅูู Google Sheets
                const result = await sendToGoogleSheets('updateDepositStatus', {
                    ID: id,
                    ุงูุญุงูุฉ: status
                });
                
                if (result && result.status === 'success') {
                    saveDataLocally();
                    
                    // ุฅุฑุณุงู ุฅุดุนุงุฑ Telegram ุนูุฏ ุงูููุงููุฉ ููุท
                    if (status === 'approved' && oldStatus === 'pending') {
                        const message = `๐ ุฅูุฏุงุน ูุคูุฏ โ

๐ค ุงูุงุณู: ${deposit.name}
๐ฑ ุงููุงุชู: ${deposit.phone}
๐ฐ ุงููุจูุบ: ${deposit.amount} ุฌููู
๐ ุงูุชุงุฑูุฎ: ${deposit.date}`;
                        sendTelegramNotification(message);
                    }
                    
                    showToast('ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุฅูุฏุงุน ุจูุฌุงุญ', 'success');
                } else {
                    showToast('ูุดู ุชุญุฏูุซ ุงูุญุงูุฉ', 'error');
                }
                
                updateUI(); 
                updateAdminDashboard(); 
            }
        }

        async function updateWithdrawalStatus(id, status) {
            const withdrawal = appData.withdrawals.find(w => w.id === id);
            if (withdrawal) { 
                const oldStatus = withdrawal.status;
                withdrawal.status = status;
                
                // ุฅุฑุณุงู ุงูุชุญุฏูุซ ุฅูู Google Sheets
                const result = await sendToGoogleSheets('updateWithdrawalStatus', {
                    ID: id,
                    ุงูุญุงูุฉ: status
                });
                
                if (result && result.status === 'success') {
                    saveData();
                    
                    // ุฅุฑุณุงู ุฅุดุนุงุฑ Telegram ุนูุฏ ุงูููุงููุฉ ููุท
                    if (status === 'approved' && oldStatus === 'pending') {
                        const message = `๐ธ ุณุญุจ ูุคูุฏ โ

๐ค ุงูุงุณู: ${withdrawal.name}
๐ฑ ุงููุงุชู: ${withdrawal.phone}
๐ฐ ุงููุจูุบ: ${withdrawal.amount} ุฌููู
๐ ุงูุณุจุจ: ${withdrawal.reason}
๐ ุงูุชุงุฑูุฎ: ${withdrawal.date}`;
                        sendTelegramNotification(message);
                    }
                    
                    showToast('ุชู ุชุญุฏูุซ ุญุงูุฉ ุงูุณุญุจ ุจูุฌุงุญ', 'success');
                } else {
                    showToast('ูุดู ุชุญุฏูุซ ุงูุญุงูุฉ', 'error');
                }
                
                updateUI(); 
                updateAdminDashboard(); 
            }
        }

        function viewProof(index) {
            const deposit = appData.deposits[index];
            if (deposit && deposit.proof) {
                const newWindow = window.open();
                newWindow.document.write(`<html dir="rtl"><head><title>ุนุฑุถ ุงูุฅุซุจุงุช</title><style>body { margin: 0; text-align: center; background: linear-gradient(135deg, #2563eb, #7c3aed); display: flex; align-items: center; justify-content: center; min-height: 100vh; } img { max-width: 90%; max-height: 90%; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }</style></head><body><img src="${deposit.proof}" alt="ุฅุซุจุงุช ุงูุฅูุฏุงุน"></body></html>`);
            }
        }

        function getStatusText(status) {
            switch(status) {
                case 'pending': return 'ูุนูู';
                case 'approved': return 'ููุจูู';
                case 'rejected': return 'ูุฑููุถ';
                default: return status;
            }
        }

        // ========== ุฏูุงู ุงูุญุฐู ==========
        function deleteDeposit(id) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุฅูุฏุงุนุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.')) {
                const deposit = appData.deposits.find(d => d.id === id);
                if (deposit) {
                    appData.deposits = appData.deposits.filter(d => d.id !== id);
                    saveData();
                    updateUI();
                    updateAdminDashboard();
                    showToast(`ุชู ุญุฐู ุฅูุฏุงุน ${deposit.name} ุจูุฌุงุญ`, 'success');
                }
            }
        }

        function deleteWithdrawal(id) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงูุณุญุจุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.')) {
                const withdrawal = appData.withdrawals.find(w => w.id === id);
                if (withdrawal) {
                    appData.withdrawals = appData.withdrawals.filter(w => w.id !== id);
                    saveData();
                    updateUI();
                    updateAdminDashboard();
                    showToast(`ุชู ุญุฐู ุณุญุจ ${withdrawal.name} ุจูุฌุงุญ`, 'success');
                }
            }
        }

        function deleteExpense(id) {
            if (confirm('ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ูุฐุง ุงููุตุฑููุ ูุง ูููู ุงูุชุฑุงุฌุน ุนู ูุฐุง ุงูุฅุฌุฑุงุก.')) {
                const expense = appData.expenses.find(e => e.id === id);
                if (expense) {
                    appData.expenses = appData.expenses.filter(e => e.id !== id);
                    saveData();
                    updateUI();
                    updateAdminDashboard();
                    showToast(`ุชู ุญุฐู ุงููุตุฑูู "${expense.description}" ุจูุฌุงุญ`, 'success');
                }
            }
        }

        // ========== ุญุฐู ุฌููุน ุงูุจูุงูุงุช ==========
        function deleteAllData() {
            const confirmation1 = confirm('โ๏ธ ุชุญุฐูุฑ: ูู ุฃูุช ูุชุฃูุฏ ูู ุญุฐู ุฌููุน ุงูุจูุงูุงุชุ\n\nุณูุชู ุญุฐู:\n- ุฌููุน ุงูุฅูุฏุงุนุงุช\n- ุฌููุน ุงููุตุฑููุงุช\n- ุฌููุน ุงูุณุญูุจุงุช\n\nูุฐุง ุงูุฅุฌุฑุงุก ูุง ูููู ุงูุชุฑุงุฌุน ุนูู!');
            
            if (!confirmation1) {
                return;
            }
            
            const confirmation2 = prompt('ููุชุฃููุฏ ุงูููุงุฆูุ ุงูุชุจ "ุญุฐู" ุจุงูุถุจุท:');
            
            if (confirmation2 === 'ุญุฐู') {
                // ุญุฐู ุฌููุน ุงูุจูุงูุงุช
                appData.deposits = [];
                appData.expenses = [];
                appData.withdrawals = [];
                
                saveData();
                updateUI();
                updateAdminDashboard();
                
                showToast('ุชู ุญุฐู ุฌููุน ุงูุจูุงูุงุช ุจูุฌุงุญ', 'success');
                
                // ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ ุจุนุฏ ุซุงููุชูู
                setTimeout(() => {
                    location.reload();
                }, 2000);
            } else {
                showToast('ุชู ุฅูุบุงุก ุนูููุฉ ุงูุญุฐู', 'info');
            }
        }

        // ========== ุทุจุงุนุฉ ุงูุชูุงุฑูุฑ ==========
        function getStatusText(status) {
            const statusTexts = {
                'approved': 'ููุจูู',
                'pending': 'ูุนูู',
                'rejected': 'ูุฑููุถ'
            };
            return statusTexts[status] || status;
        }

        function printBalanceReport() {
            const totalDeposits = appData.deposits.filter(d => d.status === 'approved').reduce((sum, d) => sum + d.amount, 0);
            const totalExpenses = appData.expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalWithdrawals = appData.withdrawals.filter(w => w.status === 'approved').reduce((sum, w) => sum + w.amount, 0);
            const currentBalance = totalDeposits - totalExpenses - totalWithdrawals;
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<!DOCTYPE html>');
            printWindow.document.write('<html dir="rtl" lang="ar">');
            printWindow.document.write('<head>');
            printWindow.document.write('<meta charset="UTF-8">');
            printWindow.document.write('<title>ุชูุฑูุฑ ุงูุฑุตูุฏ ุงููุงูู - ูููุณูุง</title>');
            printWindow.document.write('<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">');
            printWindow.document.write('<style>');
            printWindow.document.write('* { font-family: Cairo, sans-serif; margin: 0; padding: 0; box-sizing: border-box; }');
            printWindow.document.write('body { padding: 40px; background: #f8fafc; }');
            printWindow.document.write('.container { max-width: 800px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; box-shadow: 0 4px 20px rgba(0,0,0,0.1); }');
            printWindow.document.write('.header { text-align: center; margin-bottom: 40px; border-bottom: 3px solid #3b82f6; padding-bottom: 20px; }');
            printWindow.document.write('.header h1 { color: #1e40af; font-size: 2rem; margin-bottom: 10px; }');
            printWindow.document.write('.section { margin: 30px 0; }');
            printWindow.document.write('.section-title { background: linear-gradient(135deg, #3b82f6, #8b5cf6); color: white; padding: 12px 20px; border-radius: 8px; margin-bottom: 15px; font-size: 1.2rem; }');
            printWindow.document.write('.stat-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; }');
            printWindow.document.write('.stat-box { background: #f1f5f9; padding: 20px; border-radius: 8px; text-align: center; border-right: 4px solid; }');
            printWindow.document.write('.stat-box.balance { border-right-color: #3b82f6; }');
            printWindow.document.write('.stat-box.deposits { border-right-color: #10b981; }');
            printWindow.document.write('.stat-box.expenses { border-right-color: #ef4444; }');
            printWindow.document.write('.stat-box.withdrawals { border-right-color: #f59e0b; }');
            printWindow.document.write('.stat-label { color: #64748b; font-size: 0.9rem; margin-bottom: 8px; }');
            printWindow.document.write('.stat-value { color: #1e293b; font-size: 1.8rem; font-weight: 700; }');
            printWindow.document.write('.footer { margin-top: 40px; text-align: center; color: #94a3b8; font-size: 0.9rem; border-top: 2px solid #e2e8f0; padding-top: 20px; }');
            printWindow.document.write('@media print { body { padding: 0; background: white; } .container { box-shadow: none; } }');
            printWindow.document.write('</style></head><body>');
            printWindow.document.write('<div class="container">');
            printWindow.document.write('<div class="header">');
            printWindow.document.write('<h1>๐ ุชูุฑูุฑ ุงูุฑุตูุฏ ุงููุงูู</h1>');
            printWindow.document.write('<p>ูููุณูุง - ุงููุญูุธุฉ ุงูุฌูุงุนูุฉ</p>');
            printWindow.document.write('<p style="margin-top: 10px; color: #3b82f6; font-weight: 600;">ุงูุชุงุฑูุฎ: ' + new Date().toLocaleDateString('ar-EG') + '</p>');
            printWindow.document.write('</div>');
            printWindow.document.write('<div class="section">');
            printWindow.document.write('<div class="section-title">๐ฐ ููุฎุต ุงูุฑุตูุฏ</div>');
            printWindow.document.write('<div class="stat-grid">');
            printWindow.document.write('<div class="stat-box balance"><div class="stat-label">ุงูุฑุตูุฏ ุงูุญุงูู</div><div class="stat-value">' + currentBalance.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('<div class="stat-box deposits"><div class="stat-label">ุฅุฌูุงูู ุงูุฅูุฏุงุนุงุช ุงูููุจููุฉ</div><div class="stat-value">' + totalDeposits.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('<div class="stat-box expenses"><div class="stat-label">ุฅุฌูุงูู ุงููุตุฑููุงุช</div><div class="stat-value">' + totalExpenses.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('<div class="stat-box withdrawals"><div class="stat-label">ุฅุฌูุงูู ุงูุณุญูุจุงุช ุงูููุจููุฉ</div><div class="stat-value">' + totalWithdrawals.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('</div></div>');
            printWindow.document.write('<div class="section"><div class="section-title">๐ ุชูุงุตูู ุฅุถุงููุฉ</div>');
            printWindow.document.write('<table style="width: 100%; border-collapse: collapse;">');
            printWindow.document.write('<tr style="border-bottom: 1px solid #e2e8f0;"><td style="padding: 12px; color: #64748b;">ุนุฏุฏ ุงูุฅูุฏุงุนุงุช ุงูููุจููุฉ</td><td style="padding: 12px; text-align: left; font-weight: 600;">' + appData.deposits.filter(d => d.status === 'approved').length + '</td></tr>');
            printWindow.document.write('<tr style="border-bottom: 1px solid #e2e8f0;"><td style="padding: 12px; color: #64748b;">ุนุฏุฏ ุงููุตุฑููุงุช</td><td style="padding: 12px; text-align: left; font-weight: 600;">' + appData.expenses.length + '</td></tr>');
            printWindow.document.write('<tr style="border-bottom: 1px solid #e2e8f0;"><td style="padding: 12px; color: #64748b;">ุนุฏุฏ ุงูุณุญูุจุงุช ุงูููุจููุฉ</td><td style="padding: 12px; text-align: left; font-weight: 600;">' + appData.withdrawals.filter(w => w.status === 'approved').length + '</td></tr>');
            printWindow.document.write('<tr><td style="padding: 12px; color: #64748b;">ุฅุฌูุงูู ุงูุนูููุงุช</td><td style="padding: 12px; text-align: left; font-weight: 600;">' + (appData.deposits.length + appData.expenses.length + appData.withdrawals.length) + '</td></tr>');
            printWindow.document.write('</table></div>');
            printWindow.document.write('<div class="footer"><p>ุชู ุฅูุดุงุก ูุฐุง ุงูุชูุฑูุฑ ุจูุงุณุทุฉ ูุธุงู ูููุณูุง</p><p>ยฉ ' + new Date().getFullYear() + ' ุฌููุน ุงูุญููู ูุญููุธุฉ</p></div>');
            printWindow.document.write('</div>');
            printWindow.document.write('<script>window.onload = function() { setTimeout(function() { window.print(); }, 500); }<\/script>');
            printWindow.document.write('</body></html>');
            printWindow.document.close();
        }

        function printDepositsReport() {
            const deposits = [...appData.deposits].sort((a, b) => b.id - a.id);
            const approved = deposits.filter(d => d.status === 'approved');
            const pending = deposits.filter(d => d.status === 'pending');
            const rejected = deposits.filter(d => d.status === 'rejected');
            const totalApproved = approved.reduce((sum, d) => sum + d.amount, 0);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<!DOCTYPE html><html dir="rtl" lang="ar"><head><meta charset="UTF-8">');
            printWindow.document.write('<title>ุชูุฑูุฑ ุงูุฅูุฏุงุนุงุช - ูููุณูุง</title>');
            printWindow.document.write('<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">');
            printWindow.document.write('<style>* { font-family: Cairo, sans-serif; margin: 0; padding: 0; } body { padding: 40px; background: #f8fafc; } .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; } .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #10b981; padding-bottom: 20px; } .header h1 { color: #059669; font-size: 2rem; } .summary { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-bottom: 30px; } .summary-box { background: #f0fdf4; padding: 15px; border-radius: 8px; text-align: center; border-right: 4px solid #10b981; } .summary-box .label { color: #059669; font-size: 0.85rem; } .summary-box .value { color: #064e3b; font-size: 1.3rem; font-weight: 700; } table { width: 100%; border-collapse: collapse; } th { background: linear-gradient(135deg, #10b981, #059669); color: white; padding: 12px; text-align: right; } td { padding: 10px; border-bottom: 1px solid #e2e8f0; } .status { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; } .status.approved { background: #d1fae5; color: #065f46; } .status.pending { background: #fef3c7; color: #92400e; } .status.rejected { background: #fee2e2; color: #991b1b; } @media print { body { padding: 0; background: white; } }</style></head><body>');
            printWindow.document.write('<div class="container"><div class="header"><h1>๐ฅ ุชูุฑูุฑ ุงูุฅูุฏุงุนุงุช</h1>');
            printWindow.document.write('<p style="color: #059669; font-weight: 600;">ุงูุชุงุฑูุฎ: ' + new Date().toLocaleDateString('ar-EG') + '</p></div>');
            printWindow.document.write('<div class="summary">');
            printWindow.document.write('<div class="summary-box"><div class="label">ุงูููุจููุฉ</div><div class="value">' + approved.length + '</div></div>');
            printWindow.document.write('<div class="summary-box"><div class="label">ุงููุนููุฉ</div><div class="value">' + pending.length + '</div></div>');
            printWindow.document.write('<div class="summary-box"><div class="label">ุงููุฑููุถุฉ</div><div class="value">' + rejected.length + '</div></div>');
            printWindow.document.write('</div>');
            printWindow.document.write('<div style="background: #dcfce7; padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 20px;">');
            printWindow.document.write('<div style="color: #065f46;">ุฅุฌูุงูู ุงููุจุงูุบ ุงูููุจููุฉ</div>');
            printWindow.document.write('<div style="color: #059669; font-size: 1.8rem; font-weight: 700; margin-top: 5px;">' + totalApproved.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('<table><thead><tr><th>ุงูุงุณู</th><th>ุงููุงุชู</th><th>ุงููุจูุบ</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูุญุงูุฉ</th></tr></thead><tbody>');
            deposits.forEach(d => {
                printWindow.document.write('<tr><td>' + d.name + '</td><td>' + (d.phone || '-') + '</td><td style="font-weight: 600;">' + d.amount.toLocaleString('ar-EG') + ' ุฌููู</td><td>' + d.date + '</td><td><span class="status ' + d.status + '">' + getStatusText(d.status) + '</span></td></tr>');
            });
            printWindow.document.write('</tbody></table></div>');
            printWindow.document.write('<script>window.onload = function() { setTimeout(function() { window.print(); }, 500); }<\/script></body></html>');
            printWindow.document.close();
        }

        function printExpensesWithdrawalsReport() {
            const expenses = [...appData.expenses].sort((a, b) => b.id - a.id);
            const withdrawals = [...appData.withdrawals].sort((a, b) => b.id - a.id);
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalWithdrawals = withdrawals.filter(w => w.status === 'approved').reduce((sum, w) => sum + w.amount, 0);
            
            const printWindow = window.open('', '_blank');
            printWindow.document.write('<!DOCTYPE html><html dir="rtl" lang="ar"><head><meta charset="UTF-8">');
            printWindow.document.write('<title>ุชูุฑูุฑ ุงููุตุฑููุงุช ูุงูุณุญูุจุงุช - ูููุณูุง</title>');
            printWindow.document.write('<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&display=swap" rel="stylesheet">');
            printWindow.document.write('<style>* { font-family: Cairo, sans-serif; margin: 0; padding: 0; } body { padding: 40px; background: #f8fafc; } .container { max-width: 900px; margin: 0 auto; background: white; padding: 40px; border-radius: 10px; } .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #ef4444; padding-bottom: 20px; } .header h1 { color: #dc2626; font-size: 2rem; } .summary { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin-bottom: 30px; } .summary-box { padding: 15px; border-radius: 8px; text-align: center; } .summary-box.expenses { background: #fee2e2; border-right: 4px solid #ef4444; } .summary-box.withdrawals { background: #fef3c7; border-right: 4px solid #f59e0b; } .summary-box .value { font-size: 1.5rem; font-weight: 700; } .section { margin: 30px 0; } .section-title { background: linear-gradient(135deg, #ef4444, #dc2626); color: white; padding: 10px 15px; border-radius: 8px; margin-bottom: 15px; } table { width: 100%; border-collapse: collapse; } th { background: #f1f5f9; padding: 10px; text-align: right; color: #475569; } td { padding: 10px; border-bottom: 1px solid #e2e8f0; } .status { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; } .status.approved { background: #d1fae5; color: #065f46; } .status.pending { background: #fef3c7; color: #92400e; } .status.rejected { background: #fee2e2; color: #991b1b; } @media print { body { padding: 0; background: white; } }</style></head><body>');
            printWindow.document.write('<div class="container"><div class="header"><h1>๐ค ุชูุฑูุฑ ุงููุตุฑููุงุช ูุงูุณุญูุจุงุช</h1>');
            printWindow.document.write('<p style="color: #dc2626; font-weight: 600;">ุงูุชุงุฑูุฎ: ' + new Date().toLocaleDateString('ar-EG') + '</p></div>');
            printWindow.document.write('<div class="summary">');
            printWindow.document.write('<div class="summary-box expenses"><div style="color: #991b1b;">ุฅุฌูุงูู ุงููุตุฑููุงุช</div><div class="value" style="color: #dc2626;">' + totalExpenses.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('<div class="summary-box withdrawals"><div style="color: #92400e;">ุฅุฌูุงูู ุงูุณุญูุจุงุช ุงูููุจููุฉ</div><div class="value" style="color: #d97706;">' + totalWithdrawals.toLocaleString('ar-EG') + ' ุฌููู</div></div>');
            printWindow.document.write('</div>');
            printWindow.document.write('<div class="section"><div class="section-title">๐ ุงููุตุฑููุงุช (' + expenses.length + ')</div>');
            printWindow.document.write('<table><thead><tr><th>ุงููุตู</th><th>ุงููุฆุฉ</th><th>ุงููุจูุบ</th><th>ุงูุชุงุฑูุฎ</th></tr></thead><tbody>');
            if (expenses.length > 0) {
                expenses.forEach(e => {
                    printWindow.document.write('<tr><td>' + e.description + '</td><td>' + (e.category || 'ุบูุฑ ูุญุฏุฏ') + '</td><td style="font-weight: 600;">' + e.amount.toLocaleString('ar-EG') + ' ุฌููู</td><td>' + e.date + '</td></tr>');
                });
            } else {
                printWindow.document.write('<tr><td colspan="4" style="text-align: center; color: #94a3b8; padding: 20px;">ูุง ุชูุฌุฏ ูุตุฑููุงุช</td></tr>');
            }
            printWindow.document.write('</tbody></table></div>');
            printWindow.document.write('<div class="section"><div class="section-title">๐ธ ุงูุณุญูุจุงุช (' + withdrawals.length + ')</div>');
            printWindow.document.write('<table><thead><tr><th>ุงูุงุณู</th><th>ุงููุงุชู</th><th>ุงููุจูุบ</th><th>ุงูุณุจุจ</th><th>ุงูุชุงุฑูุฎ</th><th>ุงูุญุงูุฉ</th></tr></thead><tbody>');
            if (withdrawals.length > 0) {
                withdrawals.forEach(w => {
                    printWindow.document.write('<tr><td>' + w.name + '</td><td>' + w.phone + '</td><td style="font-weight: 600;">' + w.amount.toLocaleString('ar-EG') + ' ุฌููู</td><td>' + w.reason + '</td><td>' + w.date + '</td><td><span class="status ' + w.status + '">' + getStatusText(w.status) + '</span></td></tr>');
                });
            } else {
                printWindow.document.write('<tr><td colspan="6" style="text-align: center; color: #94a3b8; padding: 20px;">ูุง ุชูุฌุฏ ุณุญูุจุงุช</td></tr>');
            }
            printWindow.document.write('</tbody></table></div></div>');
            printWindow.document.write('<script>window.onload = function() { setTimeout(function() { window.print(); }, 500); }<\/script></body></html>');
            printWindow.document.close();
        }

        // ========== Admin Tabs ==========
        function switchAdminTab(tabName) {
            // ุฅุฎูุงุก ุฌููุน ุงูุชุงุจุงุช
            document.querySelectorAll('.tab-pane').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // ุฅุฒุงูุฉ active ูู ุฌููุน ุงูุฃุฒุฑุงุฑ
            document.querySelectorAll('.tab-header').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // ุฅุธูุงุฑ ุงูุชุงุจ ุงููุทููุจ
            document.getElementById(`admin-tab-${tabName}`).classList.add('active');
            
            // ุชูุนูู ุงูุฒุฑ ุงููุทููุจ ูุชุญุฏูุซ ุงูุนููุงู
            const activeBtn = event.target.closest('.tab-header');
            activeBtn.classList.add('active');
            document.getElementById('current-tab-title').textContent = activeBtn.getAttribute('data-title');
        }

        // ========== Admin Filters ==========
        let currentAdminDepositFilter = 'all';
        let currentAdminWithdrawalFilter = 'all';

        function filterAdminDeposits() {
            const searchTerm = document.getElementById('admin-deposits-search').value.toLowerCase();
            const rows = document.querySelectorAll('#admin-deposits-list tr');
            
            rows.forEach(row => {
                const name = row.cells[0]?.textContent.toLowerCase() || '';
                const phone = row.cells[1]?.textContent.toLowerCase() || '';
                const status = row.getAttribute('data-status') || '';
                
                const matchesSearch = name.includes(searchTerm) || phone.includes(searchTerm);
                const matchesFilter = currentAdminDepositFilter === 'all' || status === currentAdminDepositFilter;
                
                row.style.display = matchesSearch && matchesFilter ? '' : 'none';
            });
        }

        function filterAdminDepositsByStatus(status) {
            currentAdminDepositFilter = status;
            
            // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูููุชุฑ
            document.querySelectorAll('#admin-tab-deposits .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            filterAdminDeposits();
        }

        function filterAdminExpenses() {
            const searchTerm = document.getElementById('admin-expenses-search').value.toLowerCase();
            const rows = document.querySelectorAll('#admin-expenses-list tr');
            
            rows.forEach(row => {
                const description = row.cells[0]?.textContent.toLowerCase() || '';
                const category = row.cells[1]?.textContent.toLowerCase() || '';
                
                const matchesSearch = description.includes(searchTerm) || category.includes(searchTerm);
                
                row.style.display = matchesSearch ? '' : 'none';
            });
        }

        function filterAdminWithdrawals() {
            const searchTerm = document.getElementById('admin-withdrawals-search').value.toLowerCase();
            const rows = document.querySelectorAll('#admin-withdrawals-list tr');
            
            rows.forEach(row => {
                const name = row.cells[0]?.textContent.toLowerCase() || '';
                const phone = row.cells[1]?.textContent.toLowerCase() || '';
                const status = row.getAttribute('data-status') || '';
                
                const matchesSearch = name.includes(searchTerm) || phone.includes(searchTerm);
                const matchesFilter = currentAdminWithdrawalFilter === 'all' || status === currentAdminWithdrawalFilter;
                
                row.style.display = matchesSearch && matchesFilter ? '' : 'none';
            });
        }

        function filterAdminWithdrawalsByStatus(status) {
            currentAdminWithdrawalFilter = status;
            
            // ุชุญุฏูุซ ุฃุฒุฑุงุฑ ุงูููุชุฑ
            document.querySelectorAll('#admin-tab-withdrawals .filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            filterAdminWithdrawals();
        }

        // ========== ุงูุจุญุซ ูุงูุชุตููุฉ ==========
        let currentFilter = 'all';

        function filterDeposits() {
            const searchTerm = document.getElementById('deposits-search').value.toLowerCase();
            const rows = document.querySelectorAll('#deposits-list tr');
            
            rows.forEach(row => {
                const name = row.cells[0]?.textContent.toLowerCase() || '';
                const phone = row.cells[1]?.textContent.toLowerCase() || '';
                const status = row.getAttribute('data-status') || '';
                
                const matchesSearch = name.includes(searchTerm) || phone.includes(searchTerm);
                const matchesFilter = currentFilter === 'all' || status === currentFilter;
                
                row.style.display = matchesSearch && matchesFilter ? '' : 'none';
            });
        }

        function filterByStatus(status) {
            currentFilter = status;
            
            // Update active button
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.filter-btn').classList.add('active');
            
            filterDeposits();
        }

        // ุฏูุงู ุงูุชุตููุฉ ููุณุญูุจุงุช
        let currentWithdrawalFilter = 'all';

        function filterWithdrawals() {
            const searchTerm = document.getElementById('withdrawals-search').value.toLowerCase();
            const rows = document.querySelectorAll('#withdrawals-list tr');
            
            rows.forEach(row => {
                const name = row.cells[0]?.textContent.toLowerCase() || '';
                const phone = row.cells[1]?.textContent.toLowerCase() || '';
                const status = row.getAttribute('data-status') || '';
                
                const matchesSearch = name.includes(searchTerm) || phone.includes(searchTerm);
                const matchesFilter = currentWithdrawalFilter === 'all' || status === currentWithdrawalFilter;
                
                row.style.display = matchesSearch && matchesFilter ? '' : 'none';
            });
        }

        function filterWithdrawalsByStatus(status) {
            currentWithdrawalFilter = status;
            
            // Update active button
            const filterButtons = document.querySelectorAll('#withdrawals-list').closest('.card').querySelectorAll('.filter-btn');
            filterButtons.forEach(btn => {
                btn.classList.remove('active');
                if (btn.getAttribute('data-status') === status || btn.getAttribute('onclick')?.includes(`'${status}'`)) {
                    btn.classList.add('active');
                }
            });
            
            filterWithdrawals();
        }

        // ========== ุงูุชุฑุชูุจ ==========
        let sortDirection = {};

        function sortTable(tableId, colIndex) {
            const table = document.getElementById(tableId);
            const rows = Array.from(table.getElementsByTagName('tr'));
            const isAscending = sortDirection[colIndex] !== true;
            
            rows.sort((a, b) => {
                const aVal = a.cells[colIndex]?.textContent.trim() || '';
                const bVal = b.cells[colIndex]?.textContent.trim() || '';
                
                // ูุญุงููุฉ ุชุญููู ุฅูู ุฃุฑูุงู
                const aNum = parseFloat(aVal);
                const bNum = parseFloat(bVal);
                
                if (!isNaN(aNum) && !isNaN(bNum)) {
                    return isAscending ? aNum - bNum : bNum - aNum;
                }
                
                return isAscending ? aVal.localeCompare(bVal) : bVal.localeCompare(aVal);
            });
            
            rows.forEach(row => table.appendChild(row));
            sortDirection[colIndex] = isAscending;
        }

        // ========== ุงูุชุตุฏูุฑ ==========
        function exportDepositsToCSV() {
            let data = [];
            const filename = 'ุงูุฅูุฏุงุนุงุช.csv';
            data.push('ุงูุงุณู,ุงููุงุชู,ุงููุจูุบ,ุงูุชุงุฑูุฎ,ุงูุญุงูุฉ');
            
            appData.deposits.forEach(deposit => {
                data.push(`"${deposit.name}","${deposit.phone}","${deposit.amount}","${deposit.date}","${getStatusText(deposit.status)}"`);
            });
            
            const csv = data.join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportExpensesFromAdminToCSV() {
            let data = [];
            const filename = 'ุงููุตุฑููุงุช.csv';
            data.push('ุงููุตู,ุงูุชุตููู,ุงููุจูุบ,ุงูุชุงุฑูุฎ');
            
            appData.expenses.forEach(expense => {
                data.push(`"${expense.description}","${expense.category || ''}","${expense.amount}","${expense.date}"`);
            });
            
            const csv = data.join('\n');
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function exportDepositsToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'p',
                unit: 'mm',
                format: 'a4',
                compress: true
            });
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            
            let yPosition = 20;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            // ุงุณุชุฎุฏุงู ุงููุณุฎุฉ ุงูููููุจุฉ ูู ุงููุต ุงูุนุฑุจู
            const arabicText = reverseArabicText('ุชูุฑูุฑ ุงูุฅูุฏุงุนุงุช');
            doc.text(arabicText, pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 15;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`ุงูุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-EG')}`, pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 10;
            const columns = ['ุงูุงุณู', 'ุงููุงุชู', 'ุงููุจูุบ', 'ุงูุชุงุฑูุฎ', 'ุงูุญุงูุฉ'];
            const rows = appData.deposits.map(d => [d.name, d.phone || '-', d.amount, d.date, getStatusText(d.status)]);
            
            doc.autoTable({
                head: [columns],
                body: rows,
                startY: yPosition,
                margin: 10,
                bodyStyles: { font: 'helvetica' },
                headStyles: { font: 'helvetica' },
                didDrawPage: function(data) {
                    const str = 'ุตูุญุฉ ' + doc.internal.getNumberOfPages();
                    doc.setFontSize(10);
                    doc.text(str, pageWidth / 2, pageHeight - 10, { align: 'center' });
                }
            });
            
            doc.save('ุงูุฅูุฏุงุนุงุช.pdf');
        }

        function exportExpensesFromAdminToPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'p',
                unit: 'mm',
                format: 'a4',
                compress: true
            });
            
            const pageWidth = doc.internal.pageSize.getWidth();
            const pageHeight = doc.internal.pageSize.getHeight();
            
            let yPosition = 20;
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(16);
            const arabicText = reverseArabicText('ุชูุฑูุฑ ุงููุตุฑููุงุช');
            doc.text(arabicText, pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 15;
            doc.setFontSize(10);
            doc.setFont('helvetica', 'normal');
            doc.text(`ุงูุชุงุฑูุฎ: ${new Date().toLocaleDateString('ar-EG')}`, pageWidth / 2, yPosition, { align: 'center' });
            
            yPosition += 10;
            const columns = ['ุงููุตู', 'ุงูุชุตููู', 'ุงููุจูุบ', 'ุงูุชุงุฑูุฎ'];
            const rows = appData.expenses.map(e => [e.description, e.category || '-', e.amount, e.date]);
            
            doc.autoTable({
                head: [columns],
                body: rows,
                startY: yPosition,
                margin: 10,
                bodyStyles: { font: 'helvetica' },
                headStyles: { font: 'helvetica' },
                didDrawPage: function(data) {
                    const str = 'ุตูุญุฉ ' + doc.internal.getNumberOfPages();
                    doc.setFontSize(10);
                    doc.text(str, pageWidth / 2, pageHeight - 10, { align: 'center' });
                }
            });
            
            doc.save('ุงููุตุฑููุงุช.pdf');
        }

        // ========== ุฅุนุงุฏุฉ ุชุญุฏูุซ ุงูุจูุงูุงุช ูุน ุงูุจุญุซ ==========
        const originalUpdateDepositsPage = updateDepositsPage;
        const customUpdateDepositsPage = function() {
            originalUpdateDepositsPage.call(this);
            
            // ุฅุถุงูุฉ data-status ููู ุตู
            document.querySelectorAll('#deposits-list tr').forEach(row => {
                const statusCell = row.cells[4];
                if (statusCell) {
                    const status = statusCell.textContent.includes('ูุนูู') ? 'pending' : 
                                 statusCell.textContent.includes('ููุจูู') ? 'approved' : 
                                 statusCell.textContent.includes('ูุฑููุถ') ? 'rejected' : 'unknown';
                    row.setAttribute('data-status', status);
                }
            });
            
            filterDeposits();
        };
        updateDepositsPage = customUpdateDepositsPage;

        // ========== ุณุฌู ุงูุฃูุดุทุฉ ==========
        let activityLog = [];

        function addActivity(action, details) {
            const timestamp = new Date().toLocaleString('ar-EG');
            activityLog.unshift({
                action: action,
                details: details,
                timestamp: timestamp,
                icon: getActivityIcon(action)
            });
            // ุงูุงุญุชูุงุธ ุจู ุขุฎุฑ 50 ูุดุงุท ููุท
            if (activityLog.length > 50) activityLog.pop();
            saveActivity();
        }

        function getActivityIcon(action) {
            const icons = {
                'deposit': 'fas fa-arrow-down',
                'expense': 'fas fa-arrow-up',
                'approve': 'fas fa-check',
                'reject': 'fas fa-times',
                'login': 'fas fa-sign-in-alt'
            };
            return icons[action] || 'fas fa-info-circle';
        }

        function saveActivity() {
            localStorage.setItem('flosnaActivity', JSON.stringify(activityLog));
        }

        function loadActivity() {
            const saved = localStorage.getItem('flosnaActivity');
            if (saved) activityLog = JSON.parse(saved);
        }

        function showActivityLog() {
            const logContainer = document.getElementById('activityLog');
            if (activityLog.length === 0) {
                logContainer.innerHTML = '<p style="text-align: center; color: var(--gray-color);">ูุง ุชูุฌุฏ ุฃูุดุทุฉ ุญุชู ุงูุขู</p>';
            } else {
                logContainer.innerHTML = activityLog.map(item => `
                    <div class="activity-item">
                        <div class="activity-icon">
                            <i class="${item.icon}"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-title">${item.action}</div>
                            <div>${item.details}</div>
                            <div class="activity-time">${item.timestamp}</div>
                        </div>
                    </div>
                `).join('');
            }
            document.getElementById('activityModal').classList.add('active');
        }

        function closeActivityModal() {
            document.getElementById('activityModal').classList.remove('active');
        }

        // ========== ููุงุญุธุงุช ุงูุฅูุฏุงุนุงุช ==========
        let currentDepositId = null;

        function openNotesModal(depositId) {
            currentDepositId = depositId;
            const deposit = appData.deposits.find(d => d.id === depositId);
            document.getElementById('depositNotesInput').value = deposit?.notes || '';
            document.getElementById('notesModal').classList.add('active');
        }

        function closeNotesModal() {
            document.getElementById('notesModal').classList.remove('active');
        }

        function saveDepositNotes() {
            if (currentDepositId) {
                const deposit = appData.deposits.find(d => d.id === currentDepositId);
                if (deposit) {
                    deposit.notes = document.getElementById('depositNotesInput').value;
                    saveData();
                    addActivity('note', `ุชู ุฅุถุงูุฉ ููุงุญุธุฉ ุนูู ุฅูุฏุงุน ${deposit.name}`);
                    closeNotesModal();
                    showToast('ุชู ุญูุธ ุงูููุงุญุธุงุช ุจูุฌุงุญ', 'success');
                }
            }
        }

        // ========== ุงูุฑุณูู ุงูุจูุงููุฉ ==========
        let depositsStatusChart = null;
        let depositsVsExpensesChart = null;

        function createCharts() {
            createDepositsStatusChart();
            createDepositsVsExpensesChart();
        }

        function createDepositsStatusChart() {
            const ctx = document.getElementById('depositsStatusChart');
            if (!ctx) return;

            const approved = appData.deposits.filter(d => d.status === 'approved').length;
            const pending = appData.deposits.filter(d => d.status === 'pending').length;
            const rejected = appData.deposits.filter(d => d.status === 'rejected').length;

            if (depositsStatusChart) depositsStatusChart.destroy();

            depositsStatusChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ููุจูู', 'ูุนูู', 'ูุฑููุถ'],
                    datasets: [{
                        data: [approved, pending, rejected],
                        backgroundColor: ['#10b981', '#f59e0b', '#ef4444'],
                        borderColor: ['#059669', '#d97706', '#dc2626'],
                        borderWidth: 2,
                        hoverOffset: 10
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { size: 12, family: "'Cairo', sans-serif" },
                                padding: 15,
                                usePointStyle: true
                            }
                        }
                    }
                }
            });
        }

        function createDepositsVsExpensesChart() {
            const ctx = document.getElementById('depositsVsExpensesChart');
            if (!ctx) return;

            const approvedDeposits = appData.deposits
                .filter(d => d.status === 'approved')
                .reduce((sum, d) => sum + d.amount, 0);
            const totalExpenses = appData.expenses.reduce((sum, e) => sum + e.amount, 0);

            if (depositsVsExpensesChart) depositsVsExpensesChart.destroy();

            depositsVsExpensesChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['ุงูุฅูุฏุงุนุงุช', 'ุงููุตุฑููุงุช'],
                    datasets: [{
                        label: 'ุงููุจูุบ',
                        data: [approvedDeposits, totalExpenses],
                        backgroundColor: ['#10b981', '#ef4444'],
                        borderColor: ['#059669', '#dc2626'],
                        borderWidth: 2,
                        borderRadius: 8,
                        hoverBackgroundColor: ['#059669', '#dc2626']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    indexAxis: 'y',
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            beginAtZero: true,
                            ticks: { font: { family: "'Cairo', sans-serif" } }
                        },
                        y: {
                            ticks: { font: { family: "'Cairo', sans-serif" } }
                        }
                    }
                }
            });
        }

        // ุชุญุฏูุซ ุงูุฑุณูู ุงูุจูุงููุฉ ุนูุฏ ุชุญุฏูุซ ุงูุจูุงูุงุช
        const originalUpdateHomePage = updateHomePage;
        updateHomePage = function() {
            originalUpdateHomePage.call(this);
            setTimeout(createCharts, 100);
        };

        // ========== ุชุญุฏูุซ addExpense ูุฅุถุงูุฉ ุงูุชุตููู ==========
        const originalAddExpense = addExpense;
        addExpense = function() {
            const description = document.getElementById('expense-description').value;
            const amount = parseInt(document.getElementById('expense-amount').value);
            const category = document.getElementById('expense-category').value;
            
            if (!description || !amount) { showToast('ูุฑุฌู ููุก ุฌููุน ุงูุญููู', 'warning'); return; }
            
            const newExpense = {
                id: Date.now(),
                description: description,
                amount: amount,
                category: category,
                date: new Date().toLocaleDateString('ar-EG')
            };
            appData.expenses.push(newExpense);
            saveData();
            updateUI();
            updateAdminDashboard();
            document.getElementById('expense-form').reset();
            addActivity('expense', `ุชู ุฅุถุงูุฉ ูุตุฑูู: ${description} - ${category}`);
            showToast('ุชู ุฅุถุงูุฉ ุงููุตุฑูู ุจูุฌุงุญ', 'success');
        };

        // ุชุญููู ุณุฌู ุงูุฃูุดุทุฉ ุนูุฏ ุจุฏุก ุงูุชุทุจูู
        document.addEventListener('DOMContentLoaded', function() {
            loadActivity();
        }, { once: true });

        // ุฅุถุงูุฉ ุฃูุดุทุฉ ุนูุฏ ุฅุฌุฑุงุก ุนูููุงุช
        const originalUpdateDepositStatus = updateDepositStatus;
        updateDepositStatus = function(id, status) {
            const deposit = appData.deposits.find(d => d.id === id);
            if (deposit) {
                const statusText = status === 'approved' ? 'ูุจูู' : 'ุฑูุถ';
                addActivity(status === 'approved' ? 'approve' : 'reject', `ุชู ${statusText} ุฅูุฏุงุน ${deposit.name}`);
            }
            originalUpdateDepositStatus.call(this, id, status);
        };
    </script>

</body>
</html>
